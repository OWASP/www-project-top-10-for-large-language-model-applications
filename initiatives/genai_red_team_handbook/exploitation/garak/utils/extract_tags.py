import os
import re

probes_dir = "garak/probes"
owasp_tags = {}

for filename in os.listdir(probes_dir):
    if filename.endswith(".py"):
        filepath = os.path.join(probes_dir, filename)
        with open(filepath, "r", encoding="utf-8") as f:
            content = f.read()
            # Look for strings like "owasp:llmXX"
            matches = re.findall(r"owasp:llm\d+", content, re.IGNORECASE)
            if matches:
                probe_name = filename[:-3] # remove .py
                # normalize tags
                normalized_matches = sorted(list(set([m.lower() for m in matches])))
                owasp_tags[probe_name] = normalized_matches

for probe, tags in sorted(owasp_tags.items()):
    print(f"{probe}: {', '.join(tags)}")
