## LLM05:2025 Πλημμελής Xειρισμός  Eξόδου (Improper Output Handling)

### Περιγραφή

Ο πλημμελής χειρισμός των εξόδων αναφέρεται συγκεκριμένα στην ανεπαρκή επικύρωση, εξυγίανση και χειρισμό των εξόδων που παράγονται από μεγάλα γλωσσικά μοντέλα πριν αυτά μεταβιβαστούν σε άλλα στοιχεία και συστήματα. Δεδομένου ότι το περιεχόμενο που παράγεται από LLM μπορεί να ελέγχεται με προτροπή εισόδου, η συμπεριφορά αυτή είναι παρόμοια με την παροχή στους χρήστες έμμεσης πρόσβασης σε πρόσθετη λειτουργικότητα.
Ο ακατάλληλος χειρισμός των εκροών διαφέρει από την υπερβολική εξάρτηση στο ότι ασχολείται με τις εκροές που παράγονται από το LLM προτού μεταβιβαστούν στα επόμενα στάδια, ενώ η υπερβολική εξάρτηση επικεντρώνεται σε ευρύτερες προβληματισμούς σχετικά με την υπερβολική εξάρτηση από την ακρίβεια και την καταλληλότητα των εκροών του LLM.
Η επιτυχής εκμετάλλευση της ευπάθειας μπορεί να οδηγήσει σε XSS και CSRF σε προγράμματα περιήγησης ιστού, καθώς και σε SSRF, κλιμάκωση προνομίων ή απομακρυσμένη εκτέλεση κώδικα σε συστήματα backend.
Οι ακόλουθες συνθήκες μπορούν να αυξήσουν τον αντίκτυπο αυτής της ευπάθειας:

- Η εφαρμογή παραχωρεί στο LLM προνόμια πέραν αυτών που προορίζονται για τους τελικούς χρήστες, επιτρέποντας την κλιμάκωση προνομίων ή την απομακρυσμένη εκτέλεση κώδικα.
- Η εφαρμογή είναι ευάλωτη σε έμμεσες επιθέσεις έγχυσης προτροπής, οι οποίες θα μπορούσαν να επιτρέψουν σε έναν εισβολέα να αποκτήσει προνομιακή πρόσβαση στο περιβάλλον ενός χρήστη-στόχου.
- Οι επεκτάσεις 3ου μέρους δεν επικυρώνουν επαρκώς τις εισόδους.
- Έλλειψη κατάλληλης κωδικοποίησης εξόδου για διαφορετικά περιβάλλοντα (π.χ. HTML, JavaScript, SQL)
- Ανεπαρκής παρακολούθηση και καταγραφή των εξόδων LLM
- Απουσία περιορισμού ρυθμού ή ανίχνευσης ανωμαλιών για τη χρήση LLM

### Συνήθη Παραδείγματα Ευπάθειας

1. Η έξοδος του LLM εισάγεται απευθείας σε ένα κέλυφος του συστήματος ή σε παρόμοια λειτουργία, όπως η exec ή η eval, με αποτέλεσμα την απομακρυσμένη εκτέλεση κώδικα.
2. Η JavaScript ή το Markdown παράγεται από το LLM και επιστρέφεται σε έναν χρήστη. Στη συνέχεια, ο κώδικας ερμηνεύεται από το πρόγραμμα περιήγησης, με αποτέλεσμα την εκτέλεση XSS.
3. Τα ερωτήματα SQL που παράγονται από το LLM εκτελούνται χωρίς την κατάλληλη παραμετροποίηση, οδηγώντας σε έγχυση SQL.
4. Η έξοδος του LLM χρησιμοποιείται για την κατασκευή διαδρομών αρχείων χωρίς την κατάλληλη εξυγίανση, οδηγώντας ενδεχομένως σε ευπάθειες εντοπισμού διαδρομών (path traversal).
5. Το περιεχόμενο που παράγεται από το LLM χρησιμοποιείται σε πρότυπα ηλεκτρονικού ταχυδρομείου χωρίς κατάλληλη διαφύλαξη, οδηγώντας δυνητικά σε επιθέσεις phishing.

### Στρατηγικές Πρόληψης και Αντιμετώπισης

1. Αντιμετωπίστε το μοντέλο ως οποιονδήποτε άλλο χρήστη, υιοθετώντας μια προσέγγιση μηδενικής εμπιστοσύνης, και εφαρμόστε κατάλληλη επικύρωση εισόδου στις αποκρίσεις που προέρχονται από το μοντέλο προς τις λειτουργίες backend.
2. Ακολουθήστε τις οδηγίες OWASP ASVS (Application Security Verification Standard) για να εξασφαλίσετε αποτελεσματική επικύρωση και εξυγίανση εισόδου.
3. Κωδικοποιήστε την έξοδο του μοντέλου πίσω στους χρήστες για να μετριάσετε την ανεπιθύμητη εκτέλεση κώδικα μέσω JavaScript ή Markdown. Το OWASP ASVS παρέχει λεπτομερείς οδηγίες σχετικά με την κωδικοποίηση εξόδου.
4. Εφαρμόστε κωδικοποίηση εξόδου με γνώμονα το πλαίσιο ανάλογα με το πού θα χρησιμοποιηθεί η έξοδος του LLM (π.χ. κωδικοποίηση HTML για περιεχόμενο ιστού, SQL escapping για ερωτήματα βάσης δεδομένων).
5. Χρησιμοποιήστε παραμετροποιημένα ερωτήματα ή προετοιμασμένες εντολές για όλες τις λειτουργίες βάσης δεδομένων που περιλαμβάνουν έξοδο LLM.
6. Χρησιμοποιήστε αυστηρές πολιτικές ασφάλειας περιεχομένου (CSP) για να μετριάσετε τον κίνδυνο επιθέσεων XSS από το περιεχόμενο που παράγεται από το LLM.
7. Εφαρμόστε ισχυρά συστήματα καταγραφής και παρακολούθησης για την ανίχνευση ασυνήθιστων μοτίβων στις εξόδους LLM που μπορεί να υποδηλώνουν προσπάθειες εκμετάλλευσης.

### Παραδείγματα Σεναρίων Επίθεσης

#### Σενάριο #1

  Μια εφαρμογή χρησιμοποιεί μια επέκταση LLM για τη δημιουργία απαντήσεων για μια λειτουργία chatbot. Η επέκταση προσφέρει επίσης έναν αριθμό διοικητικών λειτουργιών που είναι προσβάσιμες σε ένα άλλο προνομιούχο LLM. Το LLM γενικού σκοπού μεταβιβάζει απευθείας την απάντησή του, χωρίς την κατάλληλη επικύρωση εξόδου, στην επέκταση προκαλώντας τη διακοπή λειτουργίας της επέκτασης για συντήρηση.

#### Σενάριο #2

  Ένας χρήστης χρησιμοποιεί ένα εργαλείο σύνοψης ιστοσελίδας που τροφοδοτείται από ένα LLM για τη δημιουργία μιας συνοπτικής περίληψης ενός άρθρου. Ο ιστότοπος περιλαμβάνει μια έγχυση προτροπής που δίνει εντολή στο LLM να καταγράψει ευαίσθητο περιεχόμενο είτε από τον ιστότοπο είτε από τη συνομιλία του χρήστη. Από εκεί το LLM μπορεί να κωδικοποιήσει τα ευαίσθητα δεδομένα και να τα στείλει, χωρίς καμία επικύρωση ή φιλτράρισμα εξόδου, σε έναν ελεγχόμενο από τον επιτιθέμενο διακομιστή.

#### Σενάριο #3

  Ένα LLM επιτρέπει στους χρήστες να δημιουργούν ερωτήματα SQL για μια βάση δεδομένων μέσω μιας λειτουργίας που μοιάζει με συνομιλία. Ένας χρήστης ζητά ένα ερώτημα για τη διαγραφή όλων των πινάκων της βάσης δεδομένων. Εάν το διαμορφωμένο ερώτημα από το LLM δεν ελεγχθεί, τότε όλοι οι πίνακες της βάσης δεδομένων θα διαγραφούν.

#### Σενάριο #4

  Μια εφαρμογή ιστού χρησιμοποιεί ένα LLM για τη δημιουργία περιεχομένου από προτροπές κειμένου του χρήστη χωρίς εξυγίανση εξόδου. Ένας επιτιθέμενος θα μπορούσε να υποβάλει μια επεξεργασμένη προτροπή προκαλώντας το LLM να επιστρέψει ένα μη εξυγιανμένο ωφέλιμο φορτίο JavaScript, οδηγώντας σε XSS κατά την απόδοση στο πρόγραμμα περιήγησης του θύματος. Η πλημμελής επικύρωση των προτροπών επέτρεψε αυτή την επίθεση.

#### Σενάριο # 5

  Ένα LLM χρησιμοποιείται για τη δημιουργία δυναμικών προτύπων ηλεκτρονικού ταχυδρομείου για μια εκστρατεία μάρκετινγκ. Ένας εισβολέας χειρίζεται το LLM για να συμπεριλάβει κακόβουλη JavaScript στο περιεχόμενο του email. Εάν η εφαρμογή δεν εξυγιαίνει επαρκώς την έξοδο LLM, αυτό θα μπορούσε να οδηγήσει σε επιθέσεις XSS στους παραλήπτες που βλέπουν το μήνυμα ηλεκτρονικού ταχυδρομείου σε ευάλωτους σταθμούς ηλεκτρονικού ταχυδρομείου.

#### Σενάριο #6

  Ένα LLM χρησιμοποιείται για τη δημιουργία κώδικα από εισόδους φυσικής γλώσσας σε μια εταιρεία λογισμικού, με στόχο τον εξορθολογισμό των εργασιών ανάπτυξης. Αν και αποτελεσματική, η προσέγγιση αυτή ενέχει τον κίνδυνο να εκθέσει ευαίσθητες πληροφορίες, να δημιουργήσει μη ασφαλείς μεθόδους χειρισμού δεδομένων ή να εισάγει ευπάθειες όπως η έγχυση SQL. Η τεχνητή νοημοσύνη μπορεί επίσης να έχει ψευδαισθήσεις ανύπαρκτων πακέτων λογισμικού, οδηγώντας δυνητικά τους προγραμματιστές να κατεβάζουν πόρους μολυσμένους με κακόβουλο λογισμικό. Η ενδελεχής εξέταση του κώδικα και η επαλήθευση των προτεινόμενων πακέτων είναι ζωτικής σημασίας για την πρόληψη παραβιάσεων ασφαλείας, μη εξουσιοδοτημένης πρόσβασης και παραβίασης του συστήματος.

### Σύνδεσμοι Αναφοράς

1. [Proof Pudding (CVE-2019-20634)](https://avidml.org/database/avid-2023-v009/) **AVID** (`moohax` & `monoxgas`)
2. [Arbitrary Code Execution](https://security.snyk.io/vuln/SNYK-PYTHON-LANGCHAIN-5411357): **Snyk Security Blog**
3. [ChatGPT Plugin Exploit Explained: From Prompt Injection to Accessing Private Data](https://embracethered.com/blog/posts/2023/chatgpt-cross-plugin-request-forgery-and-prompt-injection./): **Embrace The Red**
4. [New prompt injection attack on ChatGPT web version. Markdown images can steal your chat data.](https://systemweakness.com/new-prompt-injection-attack-on-chatgpt-web-version-ef717492c5c2?gi=8daec85e2116): **System Weakness**
5. [Don’t blindly trust LLM responses. Threats to chatbots](https://embracethered.com/blog/posts/2023/ai-injections-threats-context-matters/): **Embrace The Red**
6. [Threat Modeling LLM Applications](https://aivillage.org/large%20language%20models/threat-modeling-llm/): **AI Village**
7. [OWASP ASVS - 5 Validation, Sanitization and Encoding](https://owasp-aasvs4.readthedocs.io/en/latest/V5.html#validation-sanitization-and-encoding): **OWASP AASVS**
8. [AI hallucinates software packages and devs download them – even if potentially poisoned with malware](https://www.theregister.com/2024/03/28/ai_bots_hallucinate_software_packages/) **Theregiste**
